(globalThis.TURBOPACK || (globalThis.TURBOPACK = [])).push([typeof document === "object" ? document.currentScript : undefined,
"[project]/node_modules/@turnkey/core/dist/__stampers__/api/mobile/stamper.mjs [app-client] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "ReactNativeKeychainStamper",
    ()=>ReactNativeKeychainStamper
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$turnkey$2f$api$2d$key$2d$stamper$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@turnkey/api-key-stamper/dist/index.mjs [app-client] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$turnkey$2f$crypto$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@turnkey/crypto/dist/index.mjs [app-client] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$turnkey$2f$crypto$2f$dist$2f$crypto$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@turnkey/crypto/dist/crypto.mjs [app-client] (ecmascript)");
;
;
let Keychain;
try {
    Keychain = (()=>{
        const e = new Error("Cannot find module 'react-native-keychain'");
        e.code = 'MODULE_NOT_FOUND';
        throw e;
    })();
} catch  {
    throw new Error("Please install react-native-keychain in your app to use ReactNativeKeychainStamper");
}
class ReactNativeKeychainStamper {
    async listKeyPairs() {
        return await Keychain.getAllGenericPasswordServices();
    }
    async clearKeyPairs() {
        const keys = await this.listKeyPairs();
        for (const key of keys){
            await this.deleteKeyPair(key);
        }
    }
    async createKeyPair(externalKeyPair) {
        let privateKey;
        let publicKey;
        if (externalKeyPair) {
            privateKey = externalKeyPair.privateKey;
            publicKey = externalKeyPair.publicKey;
        } else {
            const pair = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$turnkey$2f$crypto$2f$dist$2f$crypto$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__["generateP256KeyPair"])();
            privateKey = pair.privateKey;
            publicKey = pair.publicKey;
        }
        // store in Keychain
        await Keychain.setGenericPassword(publicKey, privateKey, {
            service: publicKey
        });
        return publicKey;
    }
    async deleteKeyPair(publicKeyHex) {
        await Keychain.resetGenericPassword({
            service: publicKeyHex
        });
    }
    async getPrivateKey(publicKeyHex) {
        const creds = await Keychain.getGenericPassword({
            service: publicKeyHex
        });
        if (!creds) return null;
        return creds.password;
    }
    async stamp(payload, publicKeyHex) {
        const privateKey = await this.getPrivateKey(publicKeyHex);
        if (!privateKey) {
            throw new Error(`No private key found for public key: ${publicKeyHex}`);
        }
        const stamper = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$turnkey$2f$api$2d$key$2d$stamper$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__["ApiKeyStamper"]({
            apiPublicKey: publicKeyHex,
            apiPrivateKey: privateKey
        });
        const { stampHeaderName, stampHeaderValue } = await stamper.stamp(payload);
        return {
            stampHeaderName,
            stampHeaderValue
        };
    }
    async sign(payload, publicKeyHex, format) {
        const privateKey = await this.getPrivateKey(publicKeyHex);
        if (!privateKey) {
            throw new Error(`No private key found for public key: ${publicKeyHex}`);
        }
        const stamper = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$turnkey$2f$api$2d$key$2d$stamper$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__["ApiKeyStamper"]({
            apiPublicKey: publicKeyHex,
            apiPrivateKey: privateKey
        });
        switch(format){
            case __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$turnkey$2f$api$2d$key$2d$stamper$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__["SignatureFormat"].Raw:
                {
                    return stamper.sign(payload, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$turnkey$2f$api$2d$key$2d$stamper$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__["SignatureFormat"].Raw);
                }
            case __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$turnkey$2f$api$2d$key$2d$stamper$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__["SignatureFormat"].Der:
                return stamper.sign(payload, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$turnkey$2f$api$2d$key$2d$stamper$2f$dist$2f$index$2e$mjs__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$locals$3e$__["SignatureFormat"].Der);
            default:
                throw new Error(`Unsupported signature format: ${format}`);
        }
    }
}
;
 //# sourceMappingURL=stamper.mjs.map
}),
]);

//# sourceMappingURL=node_modules_%40turnkey_core_dist___stampers___api_mobile_stamper_mjs_1d706209._.js.map